import { validateRedirectResponse } from "./node-saml.js";
import { printSamlRequestUrl } from "./utils.js";

const url = new URL(
  // "https://localhost.dev:3001/auth/saml/logout?SAMLResponse=hVNdb9owFP0rkfdM7CSkpRah2kZBSLTaClRdXyZj34C3xI5yHQL%2Ffg4d%2FZBW9mT5%2Bpx7fI6vh9f7sgh2UKO2JiNRyEgARlqlzSYjq%2BWkNyABOmGUKKyBjBwAyfVoiKIsKj63G9u4e8DKGoTAtzLIFWpP3TpXcUrbtg3bJLT1hsaMMcquqEd1kE%2FkL97LfQCPKOt3cI94QXfCGWlqw61AjdyIEpA7yRefb%2Bc8DhkXiFA7b%2BctpTrPqWrrrLTFibJPGfsvI9eFLwrnar1uHPBHT3ppgPpDU4%2B384XcQil62nTRSiDBbJwRrXoq7X9v73DaRjdPs9lNcj9dR63Q%2BY%2F14YvaT5vVt0n6a7Eae4I5xb60GfkJLB%2FIyyS6uIyTWKUyzX1Fyn4%2Fkes1pBd%2BVRCpnAQPp7eOu7eeITYwO17D%2BRKL%2B70o6sXxkg14dMVZ%2FESCMaDTRrgjq%2FOE3lRhpSi2Fl2oYMeTzpdo3JZ2YfvDbi7I85jwo0YdTGxdCnc%2B1a7iY8iPUD8ZTrsDGZ00q1pvC4FgNIRNtcNc78ON3YX4m1pR0hzUkL5RPE3pwgnX4PvdV6sgeBBFA%2BcvhEc0XzRSAiKho2eF16b0Xz9h9Ac%3D&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=coXQX8qT0mfDkr%2FjPZpW7PhLcawMN8DWNEuB5IlGuv9FDZmrDWOUKJ2J0MDcPCxGpjBqcpyfZ%2F5T%2BnW0mE9Jad%2FIAE%2FOE4QVWGxCmd2YIkyZclZLxfnDKMFY8HGmaiCkZDV9WNw%2BDOdm3XhMc8RPM1qrR8gbHfOr9k3Ez7l%2F63fK1tMpuJ3qFKd2d9eriEhmEXThOCSgW7yc7QV9pwl3cwKuvy8kjygiX7ioeDINWcO9wMDqC7cx5GLsXJHAx4k0IAyysAaRRux1P2sJwEKN%2FX%2B%2BtP%2F1V8ZOekc9WlkwBsYU20frmrGwdY0U5mH%2FD2o2fHQ5DH1oMrKCMZhiKxKH8w%3D%3D"
  // "https://localhost.dev:3001/upvs/logout?SAMLRequest=nVNbb9owGP0rkfecKzARC6hgFMgIt1ImxpuXOMRKYqe2E2C%2FfjaXqq1EN%2B31y7l85ztx5%2BFY5EaNuSCMdoFrOcDANGIxofsu2DyPzDYwhEQ0RjmjuAtOWICHXkegIi9hyPaskk%2F4pcJCGkqJChgLopiplCW07cPhYB0aFuN723Mcx3Z8W6E05Au44pXbHbhrO00NV4hXtPbtgopTyJAgAlJUYAFlBNf9WQg9y4FICMylSvOWUn7OKTmTLGL5jXJsOc5fGQnJ1RBJycmvSmK4VaRXAUHuhtrOwnWU4gKZhOrLRhgYcyYXdMH7icS8CzzHa5qua3res9OGzRZs%2BDtgBMMuILFZ%2Bots9ztPW3yUlUExWS0HbtGMgl016IfOfFouMX2klAHjx61VT7caCFHh4OwoP1p4V4uhqpFQJM8svb5Q%2B%2BcsQnnKhLRiXMOGjlCVtVBzXT64%2FAvwLM%2BNEeMFkp%2FfTk9UkOQMVf1LIk%2Bgd7MrOUlzJDAl2NI%2BCTlae1ZbIrMZKuwExx37jePVfq40g%2BF%2F2EuOqCBqCVWC%2BrCqUE4Solv494WAsV7eIb87ngd6yniT1%2BMNnn%2FbmoNx30dfM38SMmS2qsVpvh0%2B%2BqkZ714m4%2Boa85Ls9uLWWOhOAxrjoxabHr%2B7p0P2E4Vjf5%2FRWd2YVtPBE1%2F54WmJSun302ictpOL2Af%2BbfjuGff%2BAA%3D%3D&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=L5u14xzC5wR1njlukqRdO5oZ1oh0h8exSoZ%2FjPwKcJzQZsXONc%2B0lnTj%2BlIWeFEkldWgX4CsIHxdsJdwbXogNEfquj1xlQZWBPNhhiTvpMJ1yLYlcTquoWWDqbEQNPyJB5wS656DQIPgIuqa7UNbSo4svTISNZ%2BaDBXGopvUJnwImrhsxMRLlAKJWuyCVFpnFry6o1MoqADLc0QFshGSFJuHj28sy8weTLN9vS7grI9QEdEdsp%2F4uGFjfiJO03FnXjxcOfwwl%2B1jGdBTc3PYD81GyDYrz6iKQBO5zwnC2WL78uokasYTgKUDt6BVcUMr5bhqRYeENW5eIbyGheH0HA%3D%3D"
  "https://localhost.dev:3001/upvs/logout?SAMLRequest=nVNdU%2BIwFP0rnexz27SAQEZwHFkXRlp1C%2Br6FtuUZmkTzE2B%2ButNEBzZGd2dfb09H%2Ffc05yebavSWTMFXIoBCjyMHCZSmXGxGKD57NLtIQc0FRktpWAD1DBAZ8NToFW5IlO5kLX%2ByZ5rBtoxSgJIBtwwC61XxPc3m423aXlSLfwQY%2Bzjvm9QFvIN7fHG7RN44OO2hRvEO9r6DlCtBJEUOBBBKwZEpyQ5j6Yk9DChAExpk%2BYjZfU1Z6WklqksD5RtB%2BO%2FMnJemiHVWvGnWjPyYEjvAsA%2FDfUQTZO0YBV1ubCXTRlyYqmvxbU6zzVTAxTisO0GgRuGsyAguEM6%2BBE5k9EA8cxtJqOL%2B%2BV59vQbTq6bUTeZV3wLd9FzErZZ%2BjL%2FrsZ4WRQJcu4OrYa21QlAzSY7R31sgUl7bzEyNXJB9Y5l1wezfylTWhYStJexNWnZCPVqDWZuy0dv%2FwLZySvnUqqK6q9vZycmSL6Dmv411w0aHuxWihclBSY486xPzrfeQq49WPqSVn7OslP%2Fg%2BPePjaak9F%2F2GtFBXCzhCnBfLitaclzblv494WQk9x8Qj46XoiGxrjqSpe5t1dh0fwIHrZB99fFZjPv9vpBN%2Bpp0c8i9z5x19N9zLdkhxeXMLCdTkTGtlas3W318iqOWB3JiLnx481VMxvLl7g4KYq404z7PQmzOHwT%2B4N%2FGB494%2BEr&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=PSq3VwP8fWwBSVhDwpOzUxKrJuOpuIEl5kSGe7m9OhfPU3WRyXWSTXdaP7UxWX4Obmg3Mko2y9gAAfsC5j6i5Ukulm6057DtkvvrI%2FT8oywA4qTZl2UMTxb89wBUp8yTFenO9aeneMPFicoqhSimnps4wW8PNRMRifZz3g5cYHdJToeHKyv2yctcpkqpaSrJrb8jHZmbHJwCL5GuT7sjgwObdEDbKdEkaEKcbVjkHEXZPqjOxu9NsPKPL12h3GjgUH9jJAHGJHr8weviCqvfKmTDuMDo1daK%2Fa4VY2u6aeQmic%2BZ9im1KMByIHt%2B0ZrDT7TVmlz%2FC4T6H4rktguAew%3D%3D"
);

printSamlRequestUrl(url.toString());

const query = url.searchParams;

console.log(
  await validateRedirectResponse(
    Object.fromEntries(query.entries()),
    query.toString()
  )
);

// ----------------------------

// const requestBody = {
//   SAMLResponse: `PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6
// U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOmRzaWc9Imh0dHA6Ly93d3cudzMub3Jn
// LzIwMDAvMDkveG1sZHNpZyMiIHhtbG5zOmVuYz0iaHR0cDovL3d3dy53My5vcmcv
// MjAwMS8wNC94bWxlbmMjIiB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6
// U0FNTDoyLjA6YXNzZXJ0aW9uIiB4bWxuczp4NTAwPSJ1cm46b2FzaXM6bmFtZXM6
// dGM6U0FNTDoyLjA6cHJvZmlsZXM6YXR0cmlidXRlOlg1MDAiIHhtbG5zOnhzaT0i
// aHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIERlc3Rp
// bmF0aW9uPSJodHRwczovL2xvY2FsaG9zdC5kZXY6MzAwMS9hdXRoL3NhbWwvY2Fs
// bGJhY2siIElEPSJpZC0yQTdEY3FCOXU2RVhXOW1HMmxGZDhidWtldlhkMDhjb0hx
// dGducU55IiBJblJlc3BvbnNlVG89Il8wNTVhYmFiNDFkZDBkOWViMDUxYTI4OWM1
// YTQ3NzRhZTk1MTZmYzI2IiBJc3N1ZUluc3RhbnQ9IjIwMjQtMTEtMjFUMDk6MzA6
// NDJaIiBWZXJzaW9uPSIyLjAiPjxzYW1sOklzc3VlciBGb3JtYXQ9InVybjpvYXNp
// czpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSI+aHR0cHM6
// Ly9wcmlobGFzZW5pZS51cHZzZml4Lmdvdi5zay9vYW0vZmVkPC9zYW1sOklzc3Vl
// cj48ZHNpZzpTaWduYXR1cmU+PGRzaWc6U2lnbmVkSW5mbz48ZHNpZzpDYW5vbmlj
// YWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAw
// MS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzaWc6U2lnbmF0dXJlTWV0aG9kIEFsZ29y
// aXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxkc2lnLW1vcmUjcnNh
// LXNoYTI1NiIvPjxkc2lnOlJlZmVyZW5jZSBVUkk9IiNpZC0yQTdEY3FCOXU2RVhX
// OW1HMmxGZDhidWtldlhkMDhjb0hxdGducU55Ij48ZHNpZzpUcmFuc2Zvcm1zPjxk
// c2lnOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAv
// MDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzaWc6VHJhbnNmb3Jt
// IEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMx
// NG4jIi8+PC9kc2lnOlRyYW5zZm9ybXM+PGRzaWc6RGlnZXN0TWV0aG9kIEFsZ29y
// aXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+
// PGRzaWc6RGlnZXN0VmFsdWU+L3I4OFBobXFyQzNSa1hHM0xwa1pWRDJacWE1cTNS
// QWRhNUJBeW4vRHBpMD08L2RzaWc6RGlnZXN0VmFsdWU+PC9kc2lnOlJlZmVyZW5j
// ZT48L2RzaWc6U2lnbmVkSW5mbz48ZHNpZzpTaWduYXR1cmVWYWx1ZT5NdTRMNW1I
// OHlBcE9MZ295dUdhbGxvYXdjbmRkSG4wREdiRFdiYlZOOWxhSzZoRnBvRzFDYXBG
// TitNZXJsbjNuSDk0WjdlNlJMaU5RbWdlZHNUMllpSHVHQW9mRDRhL3lPQ0NoSFNh
// dmdyWEZQUkpvS3VOSHc0WFVsTzRXOFI0eVJFYkFDNEFpbHpaU0ttOTlqdmdqL0xI
// OW5rK25pb0x0aDdocWVyMnhRLzNSS3hFZUxLb2wva0FQcjAwaGQxaGpVcUZaNnRQ
// aENjcWZvUmJBYUZnbFYvWmFPOWZIbWR0ZEQvc0FxRjVvTGUvSlJCam1xcUxxRU10
// bHpwRWRxcjA2Sm9taHhzbXY0MnliUmdHczg5elY2ZlJrazY1Sy8wbEg4ZmtuMCs4
// TURreEs4UVZLbjdNQm82NVUvWG5JYm5hVGM5Umw2eEd5MVFYc3UyZy9LbUdDbVE9
// PTwvZHNpZzpTaWduYXR1cmVWYWx1ZT48ZHNpZzpLZXlJbmZvPjxkc2lnOlg1MDlE
// YXRhPjxkc2lnOlg1MDlDZXJ0aWZpY2F0ZT5NSUlEWGpDQ0FrYWdBd0lCQWdJS0Zz
// Smk3d0FBQUFBRWRqQU5CZ2txaGtpRzl3MEJBUXNGQURBYU1SZ3dGZ1lEVlFRREV3
// OWpZUzV6Ykc5MlpXNXphMjh1YzJzd0hoY05Nak13TVRJME1USTBPRE13V2hjTk1q
// WXdNVEkwTVRJMU9ETXdXakFxTVFzd0NRWURWUVFHRXdKVFN6RWJNQmtHQTFVRUF4
// TVNhV1J3TG5Wd2RuTm1hWGd1WjI5MkxuTnJNSUlCSWpBTkJna3Foa2lHOXcwQkFR
// RUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXA0ejNmVWFyNTJrMVUxeTVPRkZwUFdGWW9s
// djc2WWsybGVCcmdpd3dnNlNob2xoV1RSM2h6dE5NWUVxblpLVU9NTlZnNkdBYm5F
// R3ZldnNkc2YveFpLWm8zbnBhcGhrS0YxT016bXJFdVQ4WUI1SjArYzdGR0lMUGdO
// ZDVQY2cwVk4yd2J3eVRKOXZ1a1lBSXhwN051Z3g1RFJBUzlrajZqTE5UL1dGaTZQ
// YTlWZEFwNGZXMDlSZzh3dGZwK1RoRGpBSnMzUFBYY1poVlk3ZXRMSkY3eXp0c242
// ZUplTzFNRXdDY2pkSjNLQVBxRURHQWJ0STN4dVI3UjNoaVBYMEZOL0lMVGs5RG9V
// SFY1QWo3RFROcXVVS2JoMnN4cm8zSytSZW1SSjBac2Z4cytPTWJBUGZXV0dPVXhP
// TmJDc05wajJHWVBUSTNnTUNvK2hpVVhwOHRuUUlEQVFBQm80R1ZNSUdTTUE0R0Ex
// VWREd0VCL3dRRUF3SUU4REFUQmdOVkhTVUVEREFLQmdnckJnRUZCUWNEQWpBZEJn
// TlZIUTRFRmdRVXBCOHFxRG9FQ2J3Y2JuQXRsRVFBUDNpcEc5OHdId1lEVlIwakJC
// Z3dGb0FVS2xPM1RocHJrMFhmNlZRcjJ0dTRUcG9Tem9Zd0RBWURWUjBUQVFIL0JB
// SXdBREFkQmdOVkhSRUVGakFVZ2hKcFpIQXVkWEIyYzJacGVDNW5iM1l1YzJzd0RR
// WUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLT0wyUGJHTzhNMytrRktDUU04dmZMTklk
// RkNRdzZPQm5SZnRMeHM4WHJkMzEwQmhob0tXWVk2d2s0VTZ4UkYzR04vNk9HWTM3
// OHJQeXhlZGVKUzJuSGpJb3BSSXdjSGc4eDRGMDlYUlVGVDI0S3JDWG0vVDE3aGlX
// Y25HdDdWSXJvZjZWSkh3b3llczdENCsrcXpvRmwxakhwdGp4N1JDYUY1cHdMeUZ6
// cy9kZ0lvemorS2FScmEyZGxsWVBrZEZLS05aazBFSnRlSzViVDRyc3IrS1lVSUx4
// QmQ4RmpBbDNLMFFqVDdXL3ZJSTJBMnN6bStkOVNUeXZxMS9NdGh1cUt5NGtrZXNl
// a1VOOGxXQmhuUnRheDM3bkZtUnFGR1hOajZaV29UVytYSzAwYWp3RSs3RVA3dmpl
// cEt3YnkveFd0VjhhZXFqajJLMDdoTnRTQTVPRkE9PC9kc2lnOlg1MDlDZXJ0aWZp
// Y2F0ZT48L2RzaWc6WDUwOURhdGE+PC9kc2lnOktleUluZm8+PC9kc2lnOlNpZ25h
// dHVyZT48c2FtbHA6U3RhdHVzPjxzYW1scDpTdGF0dXNDb2RlIFZhbHVlPSJ1cm46
// b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlJlcXVlc3RlciI+PHNhbWxw
// OlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpz
// dGF0dXM6UmVxdWVzdERlbmllZCIvPjwvc2FtbHA6U3RhdHVzQ29kZT48c2FtbHA6
// U3RhdHVzTWVzc2FnZT5UaGUgQXV0aG5SZXF1ZXN0IGNvdWxkIG5vdCBiZSB2YWxp
// ZGF0ZWQ8L3NhbWxwOlN0YXR1c01lc3NhZ2U+PC9zYW1scDpTdGF0dXM+PC9zYW1s
// cDpSZXNwb25zZT4=`,
// };

// // await validateLogoutResponsePost(requestBody);

// import { validateLogoutResponse } from "./saml2js";

// validateLogoutResponse(requestBody);
